{%- assign id = include.id | default: '' -%}
{%- assign width = include.width | default: '725' -%}
{%- assign height = include.height | default: '453' -%}
{%- assign edit = include.edit | default: 'false' -%}

<div class="embed-simulation">
  <!-- Vista pública: no forzamos parámetros de edición para evitar requerir sesión -->
  <iframe
    id="tinkercad-embed-{{ id }}"
    width="{{ width }}"
    height="{{ height }}"
    src="https://www.tinkercad.com/embed/{{ id }}"
    frameborder="0"
    marginwidth="0"
    marginheight="0"
    scrolling="no"
    title="Simulación Tinkercad — vista"
    loading="lazy"
    referrerpolicy="no-referrer-when-downgrade"
  ></iframe>
</div>

<p class="embed-fallback" id="tinkercad-fallback-{{ id }}" style="display:none; margin-top:.6rem;">
  <strong>Nota:</strong> Esta vista es pública. Si necesitas editar la simulación, abre el editor en una nueva pestaña (requiere iniciar sesión en Tinkercad):
  <a href="https://www.tinkercad.com/embed/{{ id }}?editbtn=1" target="_blank" rel="noopener noreferrer">Abrir/Editar en Tinkercad</a>
</p>

<!-- Pequeño script de heurística: si el iframe no dispara 'load' en X ms mostramos el fallback -->
<script>
  (function(){
    try {
      var id = '{{ id }}';
      var iframe = document.getElementById('tinkercad-embed-' + id);
      var fallback = document.getElementById('tinkercad-fallback-' + id);
      var loaded = false;
      if (!iframe) {
        if (fallback) fallback.style.display = 'block';
        return;
      }
      iframe.addEventListener('load', function(){ loaded = true; /* el iframe cargó */ });
      // Si no se dispara 'load' en 8s, mostramos fallback (heurístico)
      setTimeout(function(){
        if (!loaded && fallback) fallback.style.display = 'block';
      }, 8000);
    } catch (e) {
      // en caso de error, mostramos fallback
      var fb = document.getElementById('tinkercad-fallback-{{ id }}');
      if (fb) fb.style.display = 'block';
    }
  })();
</script>
