{%- assign id = include.id | default: '' -%}
{%- assign width = include.width | default: '725' -%}
{%- assign height = include.height | default: '453' -%}

<div class="embed-simulation">
  <!-- Embed mínimo, igual que tu ejemplo -->
  <iframe width="{{ width }}" height="{{ height }}" src="https://www.tinkercad.com/embed/{{ id }}" frameborder="0" marginwidth="0" marginheight="0" scrolling="no"></iframe>
</div>

<p class="embed-fallback" id="tinkercad-fallback-{{ id }}" style="display:none; margin-top:.6rem;">
  <strong>Nota:</strong> Esta vista es pública. Si necesitas editar la simulación, abre el editor en una nueva pestaña (requiere iniciar sesión en Tinkercad):
  <a href="https://www.tinkercad.com/embed/{{ id }}?editbtn=1" target="_blank" rel="noopener noreferrer">Abrir/Editar en Tinkercad</a>
</p>

<!-- Heurística: si el iframe no dispara 'load' en X ms mostramos el fallback -->
<script>
  (function(){
    try {
      var fallback = document.getElementById('tinkercad-fallback-{{ id }}');
      if (!fallback) return;
      // el iframe está justo antes del fallback en el DOM
      var container = fallback.previousElementSibling;
      var iframe = container ? container.querySelector('iframe') : null;
      var loaded = false;
      if (!iframe) { fallback.style.display = 'block'; return; }
      iframe.addEventListener('load', function(){ loaded = true; });
      setTimeout(function(){ if (!loaded) fallback.style.display = 'block'; }, 8000);
    } catch (e) {
      var fb = document.getElementById('tinkercad-fallback-{{ id }}');
      if (fb) fb.style.display = 'block';
    }
  })();
</script>
